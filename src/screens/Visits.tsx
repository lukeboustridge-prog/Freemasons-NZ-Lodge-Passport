import React,{useState}from"react";import{SectionCard}from"../components/SectionCard";export type Visit={id:string;date:string;lodgeId:string;purpose?:string;notes?:string;};export function VisitsScreen({visits,lodges,onSave,onUpdate}:{visits:Visit[];lodges:{id:string;name:string}[];onSave:(v:Visit)=>void;onUpdate:(v:Visit)=>void;}){const[form,setForm]=useState<Visit>({id:"new",date:"",lodgeId:"",purpose:"",notes:""});const lodgeName=(id:string)=>lodges.find(l=>l.id===id)?.name||"Unknown";return(<div className="space-y-4"><SectionCard title="Add visit"><form className="grid grid-cols-1 sm:grid-cols-2 gap-3" onSubmit={e=>{e.preventDefault();onSave({...form,id:crypto.randomUUID() as any});setForm({id:"new",date:"",lodgeId:"",purpose:"",notes:""});}}><label className="flex flex-col gap-1 text-sm"><span className="font-medium">Date</span><input type="date" value={form.date} onChange={e=>setForm({...form,date:e.target.value})} className="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600" required/></label><label className="flex flex-col gap-1 text-sm"><span className="font-medium">Lodge</span><select value={form.lodgeId} onChange={e=>setForm({...form,lodgeId:e.target.value})} className="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:ring-2 focus:ring-blue-600" required><option value="">Select lodge</option>{lodges.map(l=>(<option key={l.id} value={l.id}>{l.name}</option>))}</select></label><label className="flex flex-col gap-1 text-sm sm:col-span-2"><span className="font-medium">Purpose</span><input value={form.purpose||""} onChange={e=>setForm({...form,purpose:e.target.value})} className="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" placeholder="Regular meeting, installation, degree, rehearsal"/></label><label className="flex flex-col gap-1 text-sm sm:col-span-2"><span className="font-medium">Notes</span><textarea value={form.notes||""} onChange={e=>setForm({...form,notes:e.target.value})} className="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm min-h-[88px]"/></label><div className="sm:col-span-2 flex justify-end gap-2"><button type="submit" className="px-3 py-2 rounded-lg bg-blue-600 text-white">Save visit</button></div></form></SectionCard><SectionCard title="Visits"><ul className="space-y-2">{visits.map(v=>(<li key={v.id} className="rounded-lg border border-gray-200 bg-white"><details><summary className="px-3 py-2 cursor-pointer">{lodgeName(v.lodgeId)}<span className="text-xs text-gray-600 ml-2">{v.date}</span></summary><div className="border-t px-3 py-3 text-sm">{v.purpose&&<div className="mb-1"><span className="font-medium">Purpose: </span>{v.purpose}</div>}{v.notes&&<div><span className="font-medium">Notes: </span>{v.notes}</div>}<div className="mt-3 flex justify-end"><button className="px-3 py-2 rounded-lg border" onClick={e=>{e.preventDefault();onUpdate(v);}}>Edit</button></div></div></details></li>))}{visits.length===0&&<li className="text-gray-500">No visits recorded</li>}</ul></SectionCard></div>)}
